@model PFG.Inventory.Web.ViewModels.InventoryListViewModels
@{

    var title = MenuUtils.GetPageTitle(HttpContext.Current);
    UserModel userModel = ViewBag.UserModel;
}

@section BreadCrumbs{
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try { ace.settings.check('breadcrumbs', 'fixed') } catch (e) { }
        </script>
        <ul class="breadcrumb">
            <li>
                <i class="icon-wrench"></i>
                <a href="@Url.Action("Index")">基礎資料管理</a>
            </li>
            <li class="active">
                <i class="icon-group"></i>
                @title
            </li>
        </ul>
    </div>
}

@section PageHeader{

}

<div id="item-index">
    <h3 class="header smaller lighter blue">@title</h3>
    <p>
        @if (userModel.Operation.HasFlag(EnumOperation.Query))
        {
            <button id="queryBtn" class="btn btn-white btn-info btn-bold">
                <i class="ace-icon fa fa-search bigger-120 blue"></i>
                查詢
            </button>
        }
        @if (userModel.Operation.HasFlag(EnumOperation.Export))
        {
            <button id="btn-export" class="btn btn-white btn-default btn-bold">
                <i class="ace-icon fa fa-download bigger-120 blue"></i>
                匯出
            </button>

        }
    </p>


    <div class="row">
        <div class="col-sm-12">
            <div class="widget-box">
                <div class="widget-header widget-header-flat">
                    <h4 class="widget-title smaller">
                        <i class="ace-icon fa fa-quote-left smaller-80"></i>
                        查詢條件
                    </h4>
                    <div class="widget-toolbar">
                        <a href="#" data-action="collapse">
                            <i class="fa-chevron-up"></i>
                        </a>
                    </div>
                </div>

                <div class="widget-body">
                    <div class="widget-main">
                        @using (Ajax.BeginForm("Query", null, SiteLibrary.GetDefaultAjaxOptions(), new { @id = "query-form" }))
                        {
                            <div class="row">
                                <div class="col-xs-1">
                                    @Html.LabelFor(x => x.Parameters.WarehouseInfo)
                                </div>
                                <div class="col-xs-3">
                                    @*<select id="Parameters_WarehouseInfo" name="Parameters.WarehouseInfo">
                                        @foreach (var item in SelectListUtils.GetWarehouseOptions())
                                        {
                                            <option value="@item.Value">@item.Text</option>
                                        }
                                    </select>*@
                                    @Html.TextBoxFor(x=>x.Parameters.WarehouseInfo)
                                </div>
                                <div class="col-xs-offset-6">

                                </div>
                            </div>
                            <div class="row"><br /></div>
                            <div class="row">
                                <div class="col-xs-1">
                                    @Html.LabelFor(x => x.Parameters.InOrOut)
                                </div>
                                <div class="col-xs-3">
                                    @Html.TextBoxFor(x=>x.Parameters.InOrOut)
                                    @*<select id="Parameters_InOrOut" name="Parameters.InOrOut">
                                        @foreach(var item in SelectListUtils.GetInOrOutWarehouse())
                                        {
                                            <option value="@item.Value">@item.Text</option>
                                        }
                                    </select>*@
                                </div>
                                <div class="col-xs-1">
                                    @Html.LabelFor(x => x.Parameters.SelectedDate)
                                </div>
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        @Html.TextBoxFor(x => x.Parameters.SelectedDate, new { @class = "form-control input-large input-append date", @placeholder = "EX:請選擇日期" })
                                        <span class="input-group-addon">
                                            <i class="fa fa-calendar bigger-110"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <hr />
            <div id="divGridView">

            </div>
        </div>
    </div>

</div>

<div id="item-detail" style="display:none">
</div>
@section Scripts{
    <script>
        //Query查詢
        $("#queryBtn").click(function (e) {
            var warehouseID = $("#Parameters_WarehouseInfo").val();
            var inout = $("#Parameters_InOrOut").val();
            var selectedDate = $("#Parameters_SelectedDate").val();
            if (warehouseID == "" || inout == "" || selectedDate == "") {
                $.Alert("外倉、出入庫、日期都不能為空！", null, "提示");
                return;
            }
            $("#query-form").submit();
            e.preventDefault();
        });

        $("#Parameters_WarehouseInfo").select2(Application.select2("EX: 請選擇外倉","250px",'@Url.Action("GetWarehouseID","Utils")'));
        $("#Parameters_InOrOut").select2(Application.select2("EX: 請選擇出\\入庫","250px",'@Url.Action("GetOptions", "Utils")'));
        //$("#Parameters_WarehouseInfo").select2({
        //    placeholder: "請選擇外倉",
        //    minimunInputLength: 0,
        //    width: "250px",
        //    allowClear: true,
        //    dropdownCssClass: "bigdrop",
        //    formatSearching: function () { return "搜尋中，請稍後..."; },
        //    formatNoMatches: function () { return "沒有可查詢的資料"; },
        //    formatLoadMore: function () { return "更多..."; }
        //}
        //    );
        //$("#Parameters_InOrOut").select2({
        //    placeholder: "請選擇出\\入庫",
        //    minimunInputLength: 0,
        //    width: "250px",
        //    allowClear: true,
        //    dropdownCssClass: "bigdrop",
        //    formatSearching: function () { return "搜尋中，請稍後..."; },
        //    formatNoMatches: function () { return "沒有可查詢的資料"; },
        //    formatLoadMore: function () { return "更多..."; }
        //}
        //   );
        $(".date").datepicker({
            autoclose: true,
            format: "yyyy/mm/dd",
            language: "zh-TW",
            todayHighlight: true
        }).next().on(ace.click_event, function () {
            $(this).prev().focus();
        });
        //匯出
        $("#btn-export").click(function (e) {
            e.preventDefault();
            commonjs.exportHandler($("#query-form"),"@Url.Action("Query")");
        });
    </script>
    }